---
title: "Subscription costs to scientific publishers in Finland 2010-2015"
author: Leo Lahti
date: "`r Sys.Date()`"
output: 
  md_document:
    variant: markdown_github
---


```{r foi-init, message=FALSE, echo=FALSE}
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)
theme_set(theme_bw(20))
# License fee data URL
f <- "~/data/Tietopyynto/20160607\ Kustantajahintatiedot_koottu_v0.99.csv"
# Read the data
df <- read.csv(f, fileEncoding = "latin1")
# Rename
df = rename(df, Publisher = Kustantaja.Välittäjä)
df = rename(df, Organization = Organisaation.nimi)
df = rename(df, Organization.type = Organisaation.tyyppi)
df = rename(df, Category = Aineistotyyppi)
df = rename(df, Material = Aineisto)
df = rename(df, Type = Hankintatapa)
df = rename(df, Year = Vuosi)
df = rename(df, Price = Hinta)
```


Publisher subscription costs in Finland 2010-2015
===========


## Background

Following [Tim Gowers successful FOI request on the subscription costs
for scientific journals in
UK](http://gowers.wordpress.com/2014/04/24/elsevier-journals-some-facts/),
we made a similar request in Finland together with the [Open Knowledge
Finland association and other Open Science
advocates](https://www.facebook.com/groups/241398182642057/permalink/411482855633588).

After the Finnish universities turned down my FOI request in summer
2014, we appealed in court, which decided the case positive for us in
August 2015. The Finnish Ministry of Education [Open Science
Initiative](http://openscience.fi) then organized the [data release]()
as summarized [elsewhere]().

Related data have been collected in a few countries, as summarized in
Stuart Lawson's [recent
post](http://stuartlawson.org/2016/06/publicly-available-data-on-international-journal-subscription-costs).
However, Finland is now one of the first countries (after US and UK)
where the subscription fees are available at the level of individual
publishers.

Below we present a preliminary analysis of this data collection based
on automated document generation with rmarkdown (see [source
code](https://github.com/antagomir/temp/blob/master/20160610/foi.Rmd)).


## Overall subscription costs 2010-2015


```{r foi-tables, message=FALSE, echo=FALSE, fig.show="hold", out.width="430px", fig.width = 7, fig.height = 5}
dfs = df %>% group_by(Category) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Category = factor(dfs$Category, levels = rev(as.character(dfs$Category)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
names(dfs) = c("Category", "Total (MEUR)", "Percent (%)")
write.csv(dfs, file = "table/cost_by_category.csv", quote = F, row.names = F)

dfs <- df %>% group_by(Year, Organization) %>% summarise(Costs = sum(Price, na.rm = TRUE)/1e6) %>% arrange(Year) %>% spread(Year, Costs)
dfs[is.na(dfs)] = 0
dfs$Organization = as.character(dfs$Organization)
dfs$Total = rowSums(dfs[, as.character(2010:2015)], na.rm = TRUE)
dfs$Percentage = 100 * dfs$Total/sum(dfs$Total)
dfs = dfs %>% arrange(desc(Percentage))
dfs = rbind(c("Total", colSums(dfs[, -1])), dfs)
names(dfs) = c("Organization (costs in MEUR)", as.character(2010:2015), "Total", "%")
for (i in 2:ncol(dfs)) {dfs[,i] = round(as.numeric(unlist(dfs[,i])),2)}
write.csv(dfs, file = "table/cost_by_organization_year.csv", quote = F, row.names = F)


dfs <- df %>% group_by(Year, Publisher) %>% summarise(Costs = sum(Price, na.rm = TRUE)/1e6) %>% arrange(Year) %>% spread(Year, Costs)
dfs[is.na(dfs)] = 0
dfs$Publisher = as.character(dfs$Publisher)
dfs$Total = rowSums(dfs[, as.character(2010:2015)], na.rm = TRUE)
dfs$Percentage = 100 * dfs$Total/sum(dfs$Total)
dfs = dfs %>% arrange(desc(Percentage))
dfs = rbind(c("Total", colSums(dfs[, -1])), dfs)
dfs$Publisher = substr(dfs$Publisher, 1, 80)
names(dfs) = c("Publisher (costs in MEUR)", as.character(2010:2015), "Total", "%")
for (i in 2:ncol(dfs)) {dfs[,i] = round(as.numeric(unlist(dfs[,i])),2)}
write.csv(dfs, file = "table/cost_by_publisher_year.csv", quote = F, row.names = F)


dfs = df %>% group_by(Type) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Type = factor(dfs$Type, levels = rev(as.character(dfs$Type)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
names(dfs) = c("Type", "Total (MEUR)", "Percent (%)")
write.csv(dfs, file = "table/cost_by_type.csv", quote = F, row.names = F)
```

 * Total costs for Finland 2010-2015: `r round(sum(df$Price)/1e6, 1)` million EUR
 * [Total costs by subscription category](table/cost_by_category.csv)
 * [Total costs by agreement type](table/cost_by_type.csv)


```{r foi-totalcosts, message=FALSE, echo=FALSE, fig.show="hold", out.width="430px", fig.width = 7, fig.height = 5}
dfs = df %>% group_by(Organization.type) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(Costs)
dfs$Organization.type = factor(dfs$Organization.type, levels = as.character(dfs$Organization.type))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
p <- ggplot(dfs, aes(x = Organization.type, y = Costs)) + geom_bar(stat = "identity", fill = "lightgray", color = "black") + ggtitle("Costs by organization type") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)") + geom_text(aes(x=Organization.type, y=80, label=paste(Percentage, "%", sep = ""), hjust=ifelse(sign(Percentage)>0, 0, 0)), position = position_dodge(width=1), size = 7)
print(p)

dfs = df %>% group_by(Category) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Category = factor(dfs$Category, levels = rev(as.character(dfs$Category)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
# Only consider the high-level categories
dfss = dfs[-grep(";", dfs$Category),]
p <- ggplot(dfss, aes(x = Category, y = Costs)) + geom_bar(stat = "identity", fill = "lightgray", color = "black") + ggtitle("Costs by category") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)") + geom_text(aes(x=Category, y=35, label=paste(Percentage, "%", sep = ""), hjust=ifelse(sign(Percentage)>0, 0, 0)), position = position_dodge(width=1), size = 7)
print(p)
```


### Costs by publisher

 * `r length(unique(df$Publisher))` publishers ([table of annual costs by publisher](table/cost_by_publisher_year.csv))

```{r foi-totalcosts2b, message=FALSE, echo=FALSE, fig.show="hold", out.width="430px", fig.width = 10, fig.height = 9}
dfs = df %>% group_by(Publisher) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Publisher = factor(dfs$Publisher, levels = rev(as.character(dfs$Publisher)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
p <- ggplot(dfs[1:20,], aes(x = Publisher, y = Costs)) + geom_bar(stat = "identity", fill = "lightgray", color = "black") + ggtitle("Costs by publisher") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)") + geom_text(aes(x=Publisher, y=32, label=paste(Percentage, "%", sep = ""), hjust=ifelse(sign(Percentage)>0, 0, 0)), position = position_dodge(width=1), size = 7)
print(p)

dfs = df %>% group_by(Type) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Type = factor(dfs$Type, levels = rev(as.character(dfs$Type)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
```


```{r foi-costperyear, message=FALSE, eval=TRUE, echo=FALSE, fig.show="hold", out.width="200px"}
dfs = df %>% group_by(Year) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Year))
names(dfs) = c("Year", "Total (MEUR)")
```

Total costs paid to scientific publishers by Finland 2010-2015. The annual increase is indicated.

```{r foi-costbytime, message=FALSE, echo=FALSE, fig.width=8, fig.height=5}
# Price, Year : all publishers
# Growth percentage compared to previous year is shown
dfs = df %>% group_by(Year) %>% summarise(Costs = sum(Price)/1e6) 
p <- ggplot(dfs, aes(x = Year, y = Costs)) +
       geom_bar(stat = "identity", fill = "lightgray", color = "black") + ggtitle("Total costs for Finland") +
       geom_text(data = dfs[-1,], aes(x = Year, y = 1.5,
     label = paste(round(100 * diff(dfs$Costs)/dfs$Costs[-length(dfs$Costs)], 1), "%", sep = "")   ),
     	   size = 6) +
       scale_x_continuous(breaks = 2010:2015, labels = c(2010:2015)) + 
       ylab("Costs (MEUR)")
print(p)

dfs = df %>% group_by(Publisher) %>% summarise(Costs = sum(Price, na.rm = TRUE)) %>% arrange(desc(Costs))
```


Top-10 publishers (out of `r nrow(dfs)`) correspond to `r round(100 * sum(dfs[["Costs"]][1:10])/sum(dfs[["Costs"]]))`% of the overall costs.

```{r foi-timebypublisher2, message=FALSE, echo=FALSE, fig.width=12, fig.heigth=3}
top.publishers <- as.character(dfs$Publisher[1:10])
dfs <- dplyr::filter(df, Publisher %in% top.publishers) %>% group_by(Year, Publisher) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(Year)
dfs$Publisher <- factor(dfs$Publisher, levels = top.publishers)
p <- ggplot(dfs, aes(x = Year, y = Costs, color = Publisher)) +
       geom_point() +
       geom_line() +       
       ggtitle("Cost development by publisher") +
       ylab("Costs (MEUR)") 
print(p)
```


### Costs by organization

 * `r length(unique(df$Organization))` organizations ([table of annual costs by organization](table/cost_by_organization_year.csv))


```{r foi-totalcosts2, message=FALSE, echo=FALSE, fig.show="hold", out.width="430px", fig.width = 10, fig.height = 9}
dfs = df %>% group_by(Organization) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Organization = factor(dfs$Organization, levels = rev(as.character(dfs$Organization)))
dfs$Percentage = round(100 * dfs$Costs/sum(dfs$Costs), 1)
p <- ggplot(dfs[1:20,], aes(x = Organization, y = Costs)) + geom_bar(stat = "identity", fill = "lightgray", color = "black") + ggtitle("Costs by organization") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)") + geom_text(aes(x=Organization, y=20, label=paste(Percentage, "%", sep = ""), hjust=ifelse(sign(Percentage)>0, 0, 0)), position = position_dodge(width=1), size = 7)
print(p)
```


```{r foi-timebyorganization2, message=FALSE, echo=FALSE, fig.width=12, fig.heigth=3}
dfs = df %>% group_by(Organization) %>% summarise(Costs = sum(Price, na.rm = TRUE)) %>% arrange(desc(Costs))
top <- as.character(dfs$Organization[1:10])
dfs <- dplyr::filter(df, Organization %in% top) %>% group_by(Year, Organization) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(Year)
dfs$Organization <- factor(dfs$Organization, levels = top)
p <- ggplot(dfs, aes(x = Year, y = Costs, color = Organization)) +
       geom_point() +
       geom_line() +       
       ggtitle("Cost development by organization") +
       ylab("Costs (MEUR)") 
print(p)
```


