---
title: "Scientific subscription costs in Finland 2010-2015"
author: Leo Lahti
date: "`r Sys.Date()`"
---


FOI request
===========

```{r foi-init, message=FALSE, echo=FALSE}
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)
theme_set(theme_bw(20))
# License fee data URL
f <- "~/data/Tietopyynto/20160607\ Kustantajahintatiedot_koottu_v0.99.csv"
# Read the data
df <- read.csv(f, fileEncoding = "latin1")
# Rename
df = rename(df, Publisher = Kustantaja.Välittäjä)
df = rename(df, Organization = Organisaation.nimi)
df = rename(df, Material = Aineistotyyppi)
df = rename(df, Type = Hankintatapa)
df = rename(df, Year = Vuosi)
df = rename(df, Price = Hinta)
```


### Overall costs 2010-2015

```{r foi-totalcosts, message=FALSE, echo=FALSE, fig.show="hold", out.width="430px", fig.width = 8, fig.height = 5}
dfs = df %>% group_by(Organisaation.tyyppi) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(Costs)
dfs$Organisaation.tyyppi = factor(dfs$Organisaation.tyyppi, levels = as.character(dfs$Organisaation.tyyppi))
p <- ggplot(dfs, aes(x = Organisaation.tyyppi, y = Costs)) + geom_bar(stat = "identity") + ggtitle("Costs by organization type") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)")
print(p)

dfs = df %>% group_by(Organization) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Organization = factor(dfs$Organization, levels = rev(as.character(dfs$Organization)))
p <- ggplot(dfs[1:20,], aes(x = Organization, y = Costs)) + geom_bar(stat = "identity") + ggtitle("Costs by organization") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)")
print(p)
names(dfs) = c("Organization", "Total (MEUR)")
write.csv(dfs, file = "table/cost_by_organization.csv", quote = F, row.names = F)

dfs = df %>% group_by(Publisher) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Publisher = factor(dfs$Publisher, levels = rev(as.character(dfs$Publisher)))
p <- ggplot(dfs[1:20,], aes(x = Publisher, y = Costs)) + geom_bar(stat = "identity") + ggtitle("Costs by publisher") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)")
print(p)
names(dfs) = c("Publisher", "Total (MEUR)")
write.csv(dfs, file = "table/cost_by_publisher.csv", quote = F, row.names = F)


dfs = df %>% group_by(Material) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Material = factor(dfs$Material, levels = rev(as.character(dfs$Material)))
p <- ggplot(dfs[1:20,], aes(x = Material, y = Costs)) + geom_bar(stat = "identity") + ggtitle("Costs by material") + coord_flip() + xlab("") + ylab("Total Costs (MEUR)")
print(p)
names(dfs) = c("Material", "Total (MEUR)")
write.csv(dfs, file = "table/cost_by_material.csv", quote = F, row.names = F)

dfs = df %>% group_by(Type) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Costs))
dfs$Type = factor(dfs$Type, levels = rev(as.character(dfs$Type)))
names(dfs) = c("Type", "Total (MEUR)")
write.csv(dfs, file = "table/cost_by_type.csv", quote = F, row.names = F)

dfs = df %>% group_by(Year) %>% summarise(Costs = sum(Price)/1e6) %>% arrange(desc(Year))
names(dfs) = c("Year", "Total (MEUR)")
write.csv(dfs, file = "table/cost_by_year.csv", quote = F, row.names = F)
```

### Total costs for Finland 2010-2015

The total costs paid to scientific publishers by Finland 2010-2015. The annual increase is indicated.

```{r foi-timeline, message=FALSE, eval=TRUE, echo=FALSE, fig.show="hold", out.width="400px"}
# Price, Year : all publishers
# Growth percentage compared to previous year is shown
dfs = df %>% group_by(Year) %>% summarise(Costs = sum(Price)/1e6) 
p <- ggplot(dfs, aes(x = Year, y = Costs)) +
       geom_bar(stat = "identity") + ggtitle("Total costs for Finland") +
       geom_text(data = dfs[-1,], aes(x = Year, y = 1.042 * Costs,
     label = paste(round(100 * diff(dfs$Costs)/dfs$Costs[-length(dfs$Costs)], 1), "%", sep = "")   ),
     	   size = 8) +
       scale_x_continuous(breaks = 2010:2015, labels = c(2010:2015)) + 
       ylab("Costs (MEUR)")
print(p)
```


## Publication costs with top publishers 2010-2015

 * [Total costs by organization (complete table)](table/cost_by_organization.csv)
 * [Total costs by publisher (complete table)](table/cost_by_publisher.csv)
 * [Total costs by material](table/cost_by_material.csv)
 * [Total costs by type](table/cost_by_type.csv)
 * [Total costs by year](table/cost_by_year.csv)   

```{r foi-toppublishercosts, message=FALSE, eval=TRUE, echo=FALSE, fig.show="hold", out.width="200px"}
# Total cost : all publishers
dfs <- df %>% group_by(Publisher) %>% summarise(Price = sum(Price)/1e6) %>% arrange(desc(Price))
colnames(dfs) = c("Publisher", "Cost (MEUR)")
kable(head(dfs, 20))
```


## Cost development by publisher over time

Top-10 publishers shown (out of `r nrow(dfs)`) correspond to `r sum(dfs$Price[1:10])/sum(dfs$Price)`% of the overall costs.

```{r foi-timebypublisher, message=FALSE, eval=TRUE, echo=FALSE, fig.width = 5, fig.height = 5}
top.publishers <- as.character(dfs$Publisher[1:10])
# Price, Year : individual publishers compared
# Growth percentage compared to previous year is shown
dfs <- dplyr::filter(df, Publisher %in% top.publishers) %>% group_by(Year, Publisher) %>% summarise(Price = sum(Price)/1e6) %>% arrange(Year)
dfs$Publisher <- factor(dfs$Publisher, levels = top.publishers)
p <- ggplot(dfs, aes(x = Year, y = Price, color = Publisher)) +
       geom_point() +
       geom_line() +       
       ggtitle("Kokonaishintojen kehitys kustantajittain") +
       ylab("Price (EUR)") 
print(p)
```


### Relative increase in costs 2015 vs 2010

```{r foi-time, message=FALSE, eval=TRUE}
dfs <- df %>% group_by(Year, Publisher) %>% summarise(Price = sum(Price)/1e6) %>% arrange(Year)
dfss <- spread(dfs, Year, Price)
kasvu <- unlist(dfss[, "2015"]/dfss[, "2010"]);
names(kasvu) <- as.character(dfss$Publisher)
sort(kasvu)

# Relative prices with 2010 baseline
# Top relative increase
kustantajat <- dfss[,1]
hinnat = as.matrix(dfss[, -1])
hinnat <- hinnat/hinnat[,1]
dfs2 <- as.data.frame(hinnat)
dfs2$Publisher <- as.character(unlist(kustantajat, use.names = F))
dfs2 <- dfs2[!is.na(dfs2[, "2015"]),]
dfs2 <- dfs2[rev(order(dfs2[, "2015"])),]
top <- as.character(unlist(dfs2$Publisher, use.names = F)[1:10])
dfs3 <- dfs[unlist(dfs$Publisher) %in% top,]
dfs3$Publisher <- as.character(unlist(dfs3$Publisher, use.names = F))
dfs3$Publisher <- factor(dfs3$Publisher, levels = top)
dfs3$Year <- as.numeric(as.character(dfs3$Year))
dfs3$Price <- as.numeric(as.character(dfs3$Price))
p <- ggplot(dfs3,
       aes(x = Year, y = Price, color = Publisher)) +
       geom_point() +
       geom_line() +       
       ggtitle("Kokonaishintojen suhteellinen kehitys kustantajittain") +
       ylab("Price (EUR)") 
print(p)
```


